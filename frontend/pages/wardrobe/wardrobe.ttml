<!--pages/wardrobe/wardrobe.ttml-->
<scroll-view scroll-y="true" style="height: 100vh;">
  <view class="container">
  <!-- è£…é¥°èƒŒæ™¯ -->
  <view class="decoration-bg">
    <view class="floating-gem gem-1">ğŸ‘—</view>
    <view class="floating-gem gem-2">ğŸ‘ </view>
    <view class="floating-gem gem-3">ğŸ‘œ</view>
    <view class="floating-gem gem-4">ğŸ’</view>
    <view class="floating-gem gem-5">ğŸ€</view>
    <view class="floating-gem gem-6">ğŸ’„</view>
  </view>

  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view class="not-logged-in" tt:if="{{!isLoggedIn}}">
    <view class="login-prompt">
      <view class="prompt-icon">ğŸ‘—</view>
      <text class="prompt-title">æ—¶å°šè¡£æ©±ç­‰ä½ å¼€å¯</text>
      <text class="prompt-subtitle">ç™»å½•åå³å¯ç®¡ç†ä½ çš„ä¸“å±è¡£æ©±</text>
      <button class="login-btn" bindtap="goToLogin">
        <text class="btn-text">ç«‹å³ç™»å½•</text>
        <text class="btn-emoji">âœ¨</text>
      </button>
    </view>
  </view>

  <!-- å·²ç™»å½•çŠ¶æ€ -->
  <scroll-view class="content-container" scroll-y tt:if="{{isLoggedIn}}">
    
    <!-- é¡µé¢å¤´éƒ¨ -->
    <view class="page-header">
      <view class="header-title">
        <text class="title-text">æˆ‘çš„è¡£æ©±</text>
        <text class="title-emoji">ğŸ‘—</text>
      </view>
      
      <!-- å¿«é€Ÿç»Ÿè®¡ -->
      <view class="quick-stats">
        <view class="stat-item">
          <text class="stat-number">{{statistics.total_items}}</text>
          <text class="stat-label">ä»¶å•å“</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{statistics.favorite_count}}</text>
          <text class="stat-label">ä¸ªæ”¶è—</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{statistics.total_value}}</text>
          <text class="stat-label">æ€»ä»·å€¼</text>
        </view>
      </view>
    </view>

    <!-- è§†å›¾åˆ‡æ¢æ  -->
    <view class="view-tabs">
      <view 
        class="tab-item {{currentView === 'list' ? 'active' : ''}}"
        bindtap="switchView"
        data-view="list"
      >
        <text class="tab-icon">ğŸ“¦</text>
        <text class="tab-text">ç‰©å“åˆ—è¡¨</text>
      </view>
      
      <view 
        class="tab-item {{currentView === 'add' ? 'active' : ''}}"
        bindtap="switchView"
        data-view="add"
      >
        <text class="tab-icon">â•</text>
        <text class="tab-text">æ·»åŠ æ–°å“</text>
      </view>
      
      <view 
        class="tab-item {{currentView === 'stats' ? 'active' : ''}}"
        bindtap="switchView"
        data-view="stats"
      >
        <text class="tab-icon">ğŸ“Š</text>
        <text class="tab-text">æ•°æ®ç»Ÿè®¡</text>
      </view>
    </view>

    <!-- åˆ—è¡¨è§†å›¾ -->
    <view class="list-view" tt:if="{{currentView === 'list'}}">
      
      <!-- æœç´¢å’Œç­›é€‰æ  -->
      <view class="search-filter-bar">
        <view class="search-box">
          <input 
            class="search-input"
            placeholder="æœç´¢å“ç‰Œã€é¢œè‰²..."
            value="{{searchKeyword}}"
            bindinput="onSearchInput"
          />
          <view class="search-icon">ğŸ”</view>
        </view>
        
        <view class="filter-btn {{showFilters ? 'active' : ''}}" bindtap="toggleFilters">
          <text class="filter-icon">ğŸ›ï¸</text>
        </view>
      </view>

      <!-- ç­›é€‰å™¨ -->
      <view class="filters-panel {{showFilters ? 'show' : ''}}" tt:if="{{showFilters}}">
        <view class="filter-header">
          <text class="filter-title">ç­›é€‰æ¡ä»¶</text>
          <view class="filter-actions">
            <text class="clear-btn" bindtap="clearFilters">æ¸…é™¤</text>
            <text class="apply-btn" bindtap="toggleFilters">å®Œæˆ</text>
          </view>
        </view>
        
        <view class="filter-groups">
          <!-- ç±»å‹ç­›é€‰ -->
          <view class="filter-group">
            <text class="group-label">æœè£…ç±»å‹</text>
            <scroll-view class="type-scroll" scroll-x>
              <view 
                class="type-tag {{filters.type === item.value ? 'selected' : ''}}"
                tt:for="{{filterClothingTypes}}"
                tt:key="value"
                bindtap="onFilterChange"
                data-field="type"
                data-value="{{item.value}}"
              >
                <text class="type-icon">{{item.icon}}</text>
                <text class="type-text">{{item.label}}</text>
              </view>
            </scroll-view>
          </view>

          <!-- å­£èŠ‚ç­›é€‰ -->
          <view class="filter-group">
            <text class="group-label">é€‚åˆå­£èŠ‚</text>
            <view class="season-options">
              <view 
                class="season-option {{filters.season === item.value ? 'selected' : ''}}"
                tt:for="{{seasonOptions}}"
                tt:key="value"
                bindtap="onFilterChange"
                data-field="season"
                data-value="{{item.value}}"
              >
                <text>{{item.label}}</text>
              </view>
            </view>
          </view>

          <!-- æ”¶è—çŠ¶æ€ -->
          <view class="filter-group">
            <text class="group-label">æ”¶è—çŠ¶æ€</text>
            <view class="favorite-options">
              <view 
                class="favorite-option {{filters.is_favorite === null ? 'selected' : ''}}"
                bindtap="onFilterChange"
                data-field="is_favorite"
                data-value=""
              >
                <text>å…¨éƒ¨</text>
              </view>
              <view 
                class="favorite-option {{filters.is_favorite === true ? 'selected' : ''}}"
                bindtap="onFilterChange"
                data-field="is_favorite"
                data-value="true"
              >
                <text>ğŸ’– å·²æ”¶è—</text>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- ç‰©å“åˆ—è¡¨ -->
      <view class="items-waterfall">
        <view class="waterfall-column">
          <view 
            class="waterfall-item"
            tt:for="{{wardrobeItems}}"
            tt:key="id"
            tt:if="{{index % 2 === 0}}"
            bindtap="showItemDetail"
            bindlongpress="showItemActions"
            data-item="{{item}}"
          >
            <!-- ç‰©å“å›¾ç‰‡ -->
            <view class="waterfall-image-container">
              <image 
                class="waterfall-image" 
                src="{{item.image_url}}"
                mode="widthFix"
                lazy-load
              />
              <view class="image-overlay">
                <view class="overlay-actions">
                  <!-- æ”¶è—æŒ‰é’® -->
                  <view 
                    class="action-btn favorite-btn {{item.is_favorite ? 'active' : ''}}"
                    bindtap="toggleFavorite"
                    data-item="{{item}}"
                    catchtap
                  >
                    <text>{{item.is_favorite ? 'ğŸ’–' : 'ğŸ¤'}}</text>
                  </view>
                  
                  <!-- ç©¿æˆ´è®°å½•æŒ‰é’® -->
                  <view 
                    class="action-btn wear-btn"
                    bindtap="recordWear"
                    data-item="{{item}}"
                    catchtap
                  >
                    <text>ğŸ‘”</text>
                  </view>
                </view>
              </view>
            </view>

            <!-- ç‰©å“ä¿¡æ¯ -->
            <view class="waterfall-info">
              <view class="waterfall-header">
                <text class="waterfall-name">{{item.name}}</text>
                <view class="waterfall-type-badge">{{item.type}}</view>
              </view>
              
              <view class="waterfall-details">
                <text class="waterfall-color">{{item.color}}</text>
                <text class="waterfall-brand" tt:if="{{item.brand}}">{{item.brand}}</text>
              </view>
              
              <view class="waterfall-stats">
                <text class="waterfall-wear-count">{{item.wear_count}}æ¬¡</text>
                <text class="waterfall-price" tt:if="{{item.purchase_price}}">Â¥{{item.purchase_price}}</text>
              </view>
            </view>
          </view>
        </view>

        <view class="waterfall-column">
          <view 
            class="waterfall-item"
            tt:for="{{wardrobeItems}}"
            tt:key="id"
            tt:if="{{index % 2 === 1}}"
            bindtap="showItemDetail"
            bindlongpress="showItemActions"
            data-item="{{item}}"
          >
            <!-- ç‰©å“å›¾ç‰‡ -->
            <view class="waterfall-image-container">
              <image 
                class="waterfall-image" 
                src="{{item.image_url}}"
                mode="widthFix"
                lazy-load
              />
              <view class="image-overlay">
                <view class="overlay-actions">
                  <!-- æ”¶è—æŒ‰é’® -->
                  <view 
                    class="action-btn favorite-btn {{item.is_favorite ? 'active' : ''}}"
                    bindtap="toggleFavorite"
                    data-item="{{item}}"
                    catchtap
                  >
                    <text>{{item.is_favorite ? 'ğŸ’–' : 'ğŸ¤'}}</text>
                  </view>
                  
                  <!-- ç©¿æˆ´è®°å½•æŒ‰é’® -->
                  <view 
                    class="action-btn wear-btn"
                    bindtap="recordWear"
                    data-item="{{item}}"
                    catchtap
                  >
                    <text>ğŸ‘”</text>
                  </view>
                </view>
              </view>
            </view>

            <!-- ç‰©å“ä¿¡æ¯ -->
            <view class="waterfall-info">
              <view class="waterfall-header">
                <text class="waterfall-name">{{item.name}}</text>
                <view class="waterfall-type-badge">{{item.type}}</view>
              </view>
              
              <view class="waterfall-details">
                <text class="waterfall-color">{{item.color}}</text>
                <text class="waterfall-brand" tt:if="{{item.brand}}">{{item.brand}}</text>
              </view>
              
              <view class="waterfall-stats">
                <text class="waterfall-wear-count">{{item.wear_count}}æ¬¡</text>
                <text class="waterfall-price" tt:if="{{item.purchase_price}}">Â¥{{item.purchase_price}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" tt:if="{{hasMore && !isLoading}}">
        <text>ä¸Šæ‹‰åŠ è½½æ›´å¤š â†‘</text>
      </view>
      
      <!-- åŠ è½½ä¸­ -->
      <view class="loading-indicator" tt:if="{{isLoading}}">
        <view class="loading-spinner"></view>
        <text>åŠ è½½ä¸­...</text>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" tt:if="{{!isLoading && wardrobeItems.length === 0}}">
        <view class="empty-icon">ğŸ‘—</view>
        <text class="empty-title">è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•å•å“</text>
        <text class="empty-subtitle">å¿«æ¥æ·»åŠ ä½ çš„ç¬¬ä¸€ä»¶æ—¶å°šå•å“å§</text>
        <button class="add-first-btn" bindtap="switchView" data-view="add">
          <text>æ·»åŠ ç¬¬ä¸€ä»¶å•å“</text>
          <text>âœ¨</text>
        </button>
      </view>
    </view>

    <!-- æ·»åŠ è§†å›¾ -->
    <view class="add-view" tt:if="{{currentView === 'add'}}">
      <view class="add-form">
        
        <!-- å›¾ç‰‡ä¸Šä¼  -->
        <view class="form-section">
          <text class="section-title">ğŸ“· ç‰©å“ç…§ç‰‡</text>
          <view class="image-upload" bindtap="chooseImage">
            <image 
              tt:if="{{uploadedImage}}"
              class="uploaded-image"
              src="{{uploadedImage}}"
              mode="aspectFill"
            />
            <view tt:else class="upload-placeholder">
              <text class="upload-icon">ğŸ“·</text>
              <text class="upload-text">ç‚¹å‡»é€‰æ‹©å›¾ç‰‡</text>
            </view>
          </view>
          <view class="form-error" tt:if="{{errors.image}}">
            <text>{{errors.image}}</text>
          </view>
        </view>

        <!-- åŸºæœ¬ä¿¡æ¯ -->
        <view class="form-section">
          <text class="section-title">ğŸ“ åŸºæœ¬ä¿¡æ¯</text>
          
          <!-- ç‰©å“åç§° -->
          <view class="form-item">
            <text class="form-label">ç‰©å“åç§° *</text>
            <input 
              class="form-input"
              placeholder="è¯·è¾“å…¥ç‰©å“åç§°"
              value="{{addForm.name}}"
              bindinput="onFormInput"
              data-field="name"
              maxlength="100"
            />
            <view class="form-error" tt:if="{{errors.name}}">
              <text>{{errors.name}}</text>
            </view>
          </view>

          <!-- æœè£…ç±»å‹ -->
          <view class="form-item">
            <text class="form-label">æœè£…ç±»å‹</text>
            <picker 
              mode="selector"
              range="{{clothingTypes}}"
              range-key="label"
              bindchange="onPickerChange"
              data-field="type"
            >
              <view class="form-picker">
                <text class="picker-text">{{addForm.type || 'è¯·é€‰æ‹©ç±»å‹'}}</text>
                <text class="picker-arrow">></text>
              </view>
            </picker>
          </view>

          <!-- é¢œè‰² -->
          <view class="form-item">
            <text class="form-label">é¢œè‰² *</text>
            <input 
              class="form-input"
              placeholder="è¯·è¾“å…¥é¢œè‰²"
              value="{{addForm.color}}"
              bindinput="onFormInput"
              data-field="color"
              maxlength="30"
            />
            <view class="form-error" tt:if="{{errors.color}}">
              <text>{{errors.color}}</text>
            </view>
          </view>

          <!-- å“ç‰Œ -->
          <view class="form-item">
            <text class="form-label">å“ç‰Œ</text>
            <input 
              class="form-input"
              placeholder="è¯·è¾“å…¥å“ç‰Œ"
              value="{{addForm.brand}}"
              bindinput="onFormInput"
              data-field="brand"
              maxlength="50"
            />
          </view>

          <!-- å°ºç  -->
          <view class="form-item">
            <text class="form-label">å°ºç </text>
            <input 
              class="form-input"
              placeholder="å¦‚ï¼šS/M/L æˆ– 160/84A"
              value="{{addForm.size}}"
              bindinput="onFormInput"
              data-field="size"
              maxlength="20"
            />
          </view>
        </view>

        <!-- è¯¦ç»†ä¿¡æ¯ -->
        <view class="form-section">
          <text class="section-title">ğŸ“‹ è¯¦ç»†ä¿¡æ¯</text>
          
          <!-- æè´¨ -->
          <view class="form-item">
            <text class="form-label">æè´¨</text>
            <input 
              class="form-input"
              placeholder="å¦‚ï¼šæ£‰è´¨ã€ä¸ç»¸ã€ç¾Šæ¯›ç­‰"
              value="{{addForm.material}}"
              bindinput="onFormInput"
              data-field="material"
              maxlength="100"
            />
          </view>

          <!-- å­£èŠ‚ -->
          <view class="form-item">
            <text class="form-label">é€‚åˆå­£èŠ‚</text>
            <picker 
              mode="selector"
              range="{{seasonOptions}}"
              range-key="label"
              bindchange="onPickerChange"
              data-field="season"
            >
              <view class="form-picker">
                <text class="picker-text">{{addForm.season || 'è¯·é€‰æ‹©å­£èŠ‚'}}</text>
                <text class="picker-arrow">></text>
              </view>
            </picker>
          </view>

          <!-- åœºåˆ -->
          <view class="form-item">
            <text class="form-label">é€‚åˆåœºåˆ</text>
            <input 
              class="form-input"
              placeholder="å¦‚ï¼šä¼‘é—²ã€æ­£å¼ã€çº¦ä¼šç­‰"
              value="{{addForm.occasion}}"
              bindinput="onFormInput"
              data-field="occasion"
              maxlength="50"
            />
          </view>

          <!-- æè¿° -->
          <view class="form-item">
            <text class="form-label">ç‰©å“æè¿°</text>
            <textarea 
              class="form-textarea"
              placeholder="æè¿°ä¸€ä¸‹è¿™ä»¶å•å“çš„ç‰¹ç‚¹..."
              value="{{addForm.description}}"
              bindinput="onFormInput"
              data-field="description"
              maxlength="500"
              auto-height
            />
          </view>
        </view>

        <!-- è´­ä¹°ä¿¡æ¯ -->
        <view class="form-section">
          <text class="section-title">ğŸ›ï¸ è´­ä¹°ä¿¡æ¯</text>
          
          <!-- è´­ä¹°ä»·æ ¼ -->
          <view class="form-item">
            <text class="form-label">è´­ä¹°ä»·æ ¼</text>
            <view class="input-with-unit">
              <input 
                class="form-input number-input"
                type="digit"
                placeholder="è¯·è¾“å…¥ä»·æ ¼"
                value="{{addForm.purchase_price}}"
                bindinput="onFormInput"
                data-field="purchase_price"
              />
              <text class="input-unit">Â¥</text>
            </view>
            <view class="form-error" tt:if="{{errors.purchase_price}}">
              <text>{{errors.purchase_price}}</text>
            </view>
          </view>

          <!-- è´­ä¹°æ—¥æœŸ -->
          <view class="form-item">
            <text class="form-label">è´­ä¹°æ—¥æœŸ</text>
            <picker 
              mode="date"
              value="{{addForm.purchase_date}}"
              bindchange="onDateChange"
            >
              <view class="form-picker">
                <text class="picker-text">{{addForm.purchase_date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</text>
                <text class="picker-arrow">></text>
              </view>
            </picker>
          </view>

          <!-- è´­ä¹°åœ°ç‚¹ -->
          <view class="form-item">
            <text class="form-label">è´­ä¹°åœ°ç‚¹</text>
            <input 
              class="form-input"
              placeholder="å¦‚ï¼šå¤©çŒ«ã€å®ä½“åº—ç­‰"
              value="{{addForm.purchase_place}}"
              bindinput="onFormInput"
              data-field="purchase_place"
              maxlength="100"
            />
          </view>
        </view>

        <!-- é£æ ¼æ ‡ç­¾ -->
        <view class="form-section">
          <text class="section-title">ğŸ·ï¸ é£æ ¼æ ‡ç­¾ (å·²é€‰{{selectedTags.length}}ä¸ª)</text>
          <view class="tags-container">
            <view 
              class="tag-item {{item.selected ? 'selected' : ''}}"
              tt:for="{{commonTags}}"
              tt:key="name"
              bindtap="toggleTag"
              data-tag="{{item.name}}"
              data-index="{{index}}"
            >
              <text>{{item.name}}</text>
            </view>
          </view>
        </view>

        <!-- æäº¤æŒ‰é’® -->
        <view class="submit-section">
          <button 
            class="submit-btn {{isLoading ? 'loading' : ''}}"
            bindtap="submitAdd"
            disabled="{{isLoading}}"
          >
            <view tt:if="{{!isLoading}}" class="btn-content">
              <text class="btn-text">æ·»åŠ åˆ°è¡£æ©±</text>
              <text class="btn-emoji">âœ¨</text>
            </view>
            <view tt:else class="btn-loading">
              <view class="loading-spinner"></view>
              <text class="loading-text">æ·»åŠ ä¸­...</text>
            </view>
          </button>
        </view>
      </view>
    </view>

    <!-- ç»Ÿè®¡è§†å›¾ -->
    <view class="stats-view" tt:if="{{currentView === 'stats'}}">
      
      <!-- æ€»ä½“ç»Ÿè®¡ -->
      <view class="stats-overview">
        <view class="overview-title">
          <text>ğŸ“Š è¡£æ©±æ€»è§ˆ</text>
        </view>
        
        <view class="overview-grid">
          <view class="overview-item">
            <view class="overview-icon">ğŸ‘—</view>
            <view class="overview-content">
              <text class="overview-number">{{statistics.total_items}}</text>
              <text class="overview-label">æ€»å•å“æ•°</text>
            </view>
          </view>
          
          <view class="overview-item">
            <view class="overview-icon">ğŸ’–</view>
            <view class="overview-content">
              <text class="overview-number">{{statistics.favorite_count}}</text>
              <text class="overview-label">æ”¶è—å•å“</text>
            </view>
          </view>
          
          <view class="overview-item">
            <view class="overview-icon">ğŸ’°</view>
            <view class="overview-content">
              <text class="overview-number">Â¥{{statistics.total_value}}</text>
              <text class="overview-label">æ€»ä»·å€¼</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ç±»å‹åˆ†å¸ƒ -->
      <view class="stats-category">
        <view class="category-title">
          <text>ğŸ“ˆ ç±»å‹åˆ†å¸ƒ</text>
        </view>
        
        <view class="category-chart">
          <view 
            class="chart-item"
            tt:for="{{statistics.items_by_type}}"
            tt:key="index"
            tt:for-item="count"
            tt:for-index="type"
          >
            <view class="chart-bar">
              <view 
                class="bar-fill"
                style="width: {{(count / statistics.total_items * 100) || 0}}%"
              ></view>
            </view>
            <view class="chart-info">
              <text class="chart-type">{{type}}</text>
              <text class="chart-count">{{count}}ä»¶</text>
            </view>
          </view>
        </view>
      </view>

      <!-- æœ€å¸¸ç©¿å•å“ -->
      <view class="stats-popular" tt:if="{{statistics.most_worn_item}}">
        <view class="popular-title">
          <text>ğŸ”¥ æœ€å¸¸ç©¿å•å“</text>
        </view>
        
        <view class="popular-item">
          <image 
            class="popular-image"
            src="{{statistics.most_worn_item.image_url}}"
            mode="aspectFill"
          />
          <view class="popular-info">
            <text class="popular-name">{{statistics.most_worn_item.name}}</text>
            <text class="popular-stats">å·²ç©¿æˆ´ {{statistics.most_worn_item.wear_count}} æ¬¡</text>
            <text class="popular-type">{{statistics.most_worn_item.type}} Â· {{statistics.most_worn_item.color}}</text>
          </view>
        </view>
      </view>

      <!-- å¾ˆå°‘ç©¿çš„å•å“ -->
      <view class="stats-unused" tt:if="{{statistics.least_worn_items.length > 0}}">
        <view class="unused-title">
          <text>ğŸ˜´ å¾ˆå°‘ç©¿çš„å•å“</text>
        </view>
        
        <scroll-view class="unused-scroll" scroll-x>
          <view 
            class="unused-item"
            tt:for="{{statistics.least_worn_items}}"
            tt:key="id"
          >
            <image 
              class="unused-image"
              src="{{item.image_url}}"
              mode="aspectFill"
            />
            <view class="unused-info">
              <text class="unused-name">{{item.name}}</text>
              <text class="unused-count">{{item.wear_count || 0}}æ¬¡</text>
            </view>
          </view>
        </scroll-view>
      </view>
    </view>

  </scroll-view>

  <!-- åº•éƒ¨å¯¼èˆªæ  -->
  <view class="bottom-nav">
    <view class="nav-item" bindtap="switchTab" data-tab="index">
      <view class="nav-icon">ğŸ </view>
      <text class="nav-text">é¦–é¡µ</text>
    </view>
    
    <view class="nav-item" bindtap="switchTab" data-tab="analysis">
      <view class="nav-icon">ğŸ¯</view>
      <text class="nav-text">AIåˆ†æ</text>
    </view>
    
    <view class="nav-item nav-active" bindtap="switchTab" data-tab="wardrobe">
      <view class="nav-icon">ğŸ‘—</view>
      <text class="nav-text">è¡£æ©±</text>
    </view>
    
    <view class="nav-item" bindtap="switchTab" data-tab="profile">
      <view class="nav-icon">ğŸ‘¤</view>
      <text class="nav-text">æˆ‘çš„</text>
    </view>
  </view>
</view>

<!-- ç‰©å“æ“ä½œå¼¹çª— -->
<view class="action-sheet-overlay" tt:if="{{showActionSheet}}" bindtap="hideActionSheet">
  <view class="action-sheet" catchtap>
    <view class="action-sheet-header">
      <text class="sheet-title">é€‰æ‹©æ“ä½œ</text>
      <view class="sheet-close" bindtap="hideActionSheet">Ã—</view>
    </view>
    
    <view class="action-sheet-body">
      <view class="sheet-item" bindtap="recordWear" data-item="{{selectedItem}}">
        <view class="sheet-icon">ğŸ‘”</view>
        <text class="sheet-text">è®°å½•ç©¿æˆ´</text>
      </view>
      
      <view class="sheet-item" bindtap="toggleFavorite" data-item="{{selectedItem}}">
        <view class="sheet-icon">{{selectedItem.is_favorite ? 'ğŸ’”' : 'ğŸ’–'}}</view>
        <text class="sheet-text">{{selectedItem.is_favorite ? 'å–æ¶ˆæ”¶è—' : 'åŠ å…¥æ”¶è—'}}</text>
      </view>
      
      <view class="sheet-item delete-item" bindtap="deleteItem">
        <view class="sheet-icon">ğŸ—‘ï¸</view>
        <text class="sheet-text">åˆ é™¤ç‰©å“</text>
      </view>
    </view>
  </view>
</view>

<!-- å•†å“è¯¦æƒ…å¼¹çª— -->
<view class="detail-overlay" tt:if="{{showItemDetail}}" bindtap="hideItemDetail">
  <view class="detail-modal" catchtap>
    <view class="detail-header">
      <text class="detail-title">ç‰©å“è¯¦æƒ…</text>
      <view class="detail-close" bindtap="hideItemDetail">Ã—</view>
    </view>
    
    <scroll-view class="detail-content" scroll-y>
      <view class="detail-image-section">
        <image 
          class="detail-image"
          src="{{detailItem.image_url}}"
          mode="aspectFill"
        />
        <view class="detail-actions">
          <view 
            class="detail-action-btn {{detailItem.is_favorite ? 'active' : ''}}"
            bindtap="toggleFavorite"
            data-item="{{detailItem}}"
          >
            <text>{{detailItem.is_favorite ? 'ğŸ’– å·²æ”¶è—' : 'ğŸ¤ æ”¶è—'}}</text>
          </view>
          <view 
            class="detail-action-btn"
            bindtap="recordWear"
            data-item="{{detailItem}}"
          >
            <text>ğŸ‘” è®°å½•ç©¿æˆ´</text>
          </view>
        </view>
      </view>

      <view class="detail-info-section">
        <view class="detail-main-info">
          <text class="detail-name">{{detailItem.name}}</text>
          <view class="detail-type-badge">{{detailItem.type}}</view>
        </view>

        <view class="detail-basic-info">
          <view class="detail-info-row">
            <text class="detail-label">é¢œè‰²</text>
            <text class="detail-value">{{detailItem.color}}</text>
          </view>
          <view class="detail-info-row" tt:if="{{detailItem.brand}}">
            <text class="detail-label">å“ç‰Œ</text>
            <text class="detail-value">{{detailItem.brand}}</text>
          </view>
          <view class="detail-info-row" tt:if="{{detailItem.size}}">
            <text class="detail-label">å°ºç </text>
            <text class="detail-value">{{detailItem.size}}</text>
          </view>
          <view class="detail-info-row" tt:if="{{detailItem.material}}">
            <text class="detail-label">æè´¨</text>
            <text class="detail-value">{{detailItem.material}}</text>
          </view>
        </view>

        <view class="detail-usage-stats">
          <view class="stat-card">
            <text class="stat-number">{{detailItem.wear_count}}</text>
            <text class="stat-label">ç©¿æˆ´æ¬¡æ•°</text>
          </view>
          <view class="stat-card" tt:if="{{detailItem.purchase_price}}">
            <text class="stat-number">Â¥{{detailItem.purchase_price}}</text>
            <text class="stat-label">è´­ä¹°ä»·æ ¼</text>
          </view>
          <view class="stat-card" tt:if="{{detailItem.last_worn_date}}">
            <text class="stat-number">{{detailItem.last_worn_date}}</text>
            <text class="stat-label">æœ€åç©¿æˆ´</text>
          </view>
        </view>

        <view class="detail-additional-info" tt:if="{{detailItem.season || detailItem.occasion || detailItem.style_tags}}">
          <view class="detail-info-row" tt:if="{{detailItem.season}}">
            <text class="detail-label">é€‚åˆå­£èŠ‚</text>
            <text class="detail-value">{{detailItem.season}}</text>
          </view>
          <view class="detail-info-row" tt:if="{{detailItem.occasion}}">
            <text class="detail-label">é€‚åˆåœºåˆ</text>
            <text class="detail-value">{{detailItem.occasion}}</text>
          </view>
          <view class="detail-tags" tt:if="{{detailItem.style_tags && detailItem.style_tags.length > 0}}">
            <text class="detail-label">é£æ ¼æ ‡ç­¾</text>
            <view class="detail-tags-container">
              <view 
                class="detail-tag"
                tt:for="{{detailItem.style_tags}}"
                tt:key="*this"
              >
                <text>{{item}}</text>
              </view>
            </view>
          </view>
        </view>

        <view class="detail-description" tt:if="{{detailItem.description}}">
          <text class="detail-label">æè¿°</text>
          <text class="detail-desc-text">{{detailItem.description}}</text>
        </view>

        <view class="detail-purchase-info" tt:if="{{detailItem.purchase_date || detailItem.purchase_place}}">
          <text class="detail-section-title">è´­ä¹°ä¿¡æ¯</text>
          <view class="detail-info-row" tt:if="{{detailItem.purchase_date}}">
            <text class="detail-label">è´­ä¹°æ—¥æœŸ</text>
            <text class="detail-value">{{detailItem.purchase_date}}</text>
          </view>
          <view class="detail-info-row" tt:if="{{detailItem.purchase_place}}">
            <text class="detail-label">è´­ä¹°åœ°ç‚¹</text>
            <text class="detail-value">{{detailItem.purchase_place}}</text>
          </view>
        </view>
      </view>
    </scroll-view>

    <view class="detail-footer">
      <button class="detail-btn secondary" bindtap="hideItemDetail">
        <text>å…³é—­</text>
      </button>
      <button 
        class="detail-btn primary" 
        bindtap="showActionsFromDetail"
        data-item="{{detailItem}}"
      >
        <text>æ›´å¤šæ“ä½œ</text>
      </button>
    </view>
  </view>
</view>

<!-- AIæ‚¬æµ®çƒ -->
<ai-floating-bot 
  visible="{{true}}"
  is-online="{{true}}"
  message-count="{{0}}"
  bind:botclick="onAIBotClick"
  pageContext="wardrobe">
</ai-floating-bot>